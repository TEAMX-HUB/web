/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import"../geometry.js";import e from"../request.js";import{ensureClass as t}from"../core/accessorSupport/ensureType.js";import r from"../portal/Portal.js";import{asValidOptions as s,parseUrl as a}from"./utils.js";import o from"./support/FetchPlaceParameters.js";import i from"./support/PlacesQueryParameters.js";import n from"./support/PlacesQueryResult.js";import{projectWithEngineOrService as u}from"../views/support/projectionUtils.js";import p from"../geometry/SpatialReference.js";async function m(r,a){r=t(o,r);const i={requestedFields:r.requestedFields?.join(),token:r.apiKey},n=s(i,a),{data:u}=await e(`${r.url}/places/${r.placeId}`,n);return u}async function c(e,s){const a={radius:(e=t(i,e)).radius};let o=e.point;return o&&!o.spatialReference.isWGS84&&(o=await u(o,p.WGS84,r.getDefault(),s?.signal)),o&&(a.x=o.x,a.y=o.y),f(`${e.url}/places/near-point`,a,e,s)}async function l(e,s){const a={};let o=(e=t(i,e)).extent;return o&&!o.spatialReference.isWGS84&&(o=await u(o,p.WGS84,r.getDefault(),s?.signal)),o&&(a.xmin=o.xmin,a.ymin=o.ymin,a.xmax=o.xmax,a.ymax=o.ymax),f(`${e.url}/places/within-extent`,a,e,s)}async function f(t,r,o,i){r={...r,categoryIds:o.categoryIds?.join(),offset:o.offset,pageSize:o.pageSize,searchText:o.searchText,token:o.apiKey};const u=s(r,i),{data:p}=await e(t,u),m=new n;m.maxResultsExceeded=p.maxResultsExceeded,m.results=p.results;const{links:c}=p;if(c?.next){m.nextQueryParams=o.clone();const e=a(c.next).query;m.nextQueryParams.offset=Number(e.offset)}if(c?.previous){m.previousQueryParams=o.clone();const e=a(c.previous).query;m.previousQueryParams.offset=Number(e.offset)}return m}export{m as fetchPlace,c as queryPlacesNearPoint,l as queryPlacesWithinExtent};
